<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Document Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .viewer-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .document-section {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .image-container {
            margin: 10px 0;
            text-align: center;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            margin: 10px;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîç Quick Document Viewer</h1>
    <p>Enter a service request ID to view its uploaded documents</p>

    <div class="viewer-container">
        <div class="input-group">
            <label for="requestId">Service Request ID:</label>
            <input type="number" id="requestId" placeholder="Enter request ID (e.g., 1, 2, 3...)" min="1">
        </div>
        
        <button onclick="viewDocuments()">üìÑ View Documents</button>
        <button onclick="openFullViewer()">üìã View All Requests</button>
    </div>

    <div id="result"></div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        
        async function viewDocuments() {
            const requestId = document.getElementById('requestId').value;
            const resultDiv = document.getElementById('result');
            
            if (!requestId) {
                resultDiv.innerHTML = '<div class="error">Please enter a service request ID</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div>Loading...</div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/service-requests/${requestId}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayDocuments(result.data);
                } else {
                    resultDiv.innerHTML = `<div class="error">Service request #${requestId} not found</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        
        function displayDocuments(request) {
            const resultDiv = document.getElementById('result');
            
            let html = `
                <div class="viewer-container">
                    <h2>üìã Service Request #${request.id}</h2>
                    <div style="margin-bottom: 20px;">
                        <strong>Name:</strong> ${request.name}<br>
                        <strong>Service Type:</strong> ${request.service_type}<br>
                        <strong>Status:</strong> ${request.status?.name || 'Unknown'}<br>
                        <strong>Submitted:</strong> ${new Date(request.created_at).toLocaleDateString()}
                    </div>
            `;
            
            // ID Card Documents
            if (request.id_card && request.id_card.length > 0) {
                html += `
                    <div class="document-section">
                        <h3>üÜî ID Card Documents</h3>
                `;
                
                request.id_card.forEach((imageUrl, index) => {
                    const label = index === 0 ? 'Front Side' : 'Back Side';
                    html += `
                        <div class="image-container">
                            <h4>${label}</h4>
                            <img src="${imageUrl}" alt="ID Card ${label}" onclick="window.open('${imageUrl}', '_blank')">
                            <br>
                            <small>Click image to view full size</small>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            // Family Book Documents
            if (request.family_book && request.family_book.length > 0) {
                html += `
                    <div class="document-section">
                        <h3>üìñ Family Book Documents (·ûü·üÄ·ûú·ûó·üÖ·ûÇ·üí·ûö·ûΩ·ûü·û∂·ûö)</h3>
                `;
                
                request.family_book.forEach((imageUrl, index) => {
                    html += `
                        <div class="image-container">
                            <h4>Page ${index + 1}</h4>
                            <img src="${imageUrl}" alt="Family Book Page ${index + 1}" onclick="window.open('${imageUrl}', '_blank')">
                            <br>
                            <small>Click image to view full size</small>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            if ((!request.id_card || request.id_card.length === 0) && 
                (!request.family_book || request.family_book.length === 0)) {
                html += '<div class="error">No documents found for this service request</div>';
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }
        
        function openFullViewer() {
            window.open('view-documents.html', '_blank');
        }
        
        // Allow Enter key to trigger search
        document.getElementById('requestId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                viewDocuments();
            }
        });
    </script>
</body>
</html>
